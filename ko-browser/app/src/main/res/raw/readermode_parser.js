function Readability(b,c,a){a=a||{};this._uri=b;this._doc=c;this._biggestFrame=false;this._articleTitle=null;this._articleByline=null;this._articleDir=null;this._debug=!!a.debug;this._maxElemsToParse=a.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE;this._nbTopCandidates=a.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES;this._maxPages=a.maxPages||this.DEFAULT_MAX_PAGES;this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY;this._parsedPages={};this._pageETags={};this._curPageNum=1;var d;if(this._debug){d=function(h){var i=h.nodeName+" ";if(h.nodeType==h.TEXT_NODE){return i+'("'+h.textContent+'")'}var f=h.className&&("."+h.className.replace(/ /g,"."));var g="";if(h.id){g="(#"+h.id+f+")"}else{if(f){g="("+f+")"}}return i+g};this.log=function(){if(typeof dump!=="undefined"){var f=Array.prototype.map.call(arguments,function(g){return(g&&g.nodeName)?d(g):g}).join(" ");dump("Reader: (Readability) "+f+"\n")}else{if(typeof console!=="undefined"){var e=["Reader: (Readability) "].concat(arguments);console.log.apply(console,e)}}}}else{this.log=function(){}}}Readability.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_MAX_PAGES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),REGEXPS:{unlikelyCandidates:/banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|foot|header|legends|menu|modal|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|masthead|media|meta|modal|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?(dailymotion|youtube|youtube-nocookie|player\.vimeo)\.com/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,whitespace:/^\s*$/,hasContent:/\S$/},DIV_TO_P_ELEMS:["A","BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL","SELECT"],ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],_postProcessContent:function(a){this._fixRelativeUris(a)},_removeNodes:function(b,e){for(var c=b.length-1;c>=0;c--){var d=b[c];var a=d.parentNode;if(a){if(!e||e.call(this,d,c,b)){a.removeChild(d)}}}},_replaceNodeTags:function(a,d){for(var b=a.length-1;b>=0;b--){var c=a[b];this._setNodeTag(c,d)}},_forEachNode:function(a,b){Array.prototype.forEach.call(a,b,this)},_someNode:function(a,b){return Array.prototype.some.call(a,b,this)},_concatNodeLists:function(){var c=Array.prototype.slice;var a=c.call(arguments);var b=a.map(function(d){return c.call(d)});return Array.prototype.concat.apply([],b)},_getAllNodesWithTag:function(b,a){if(b.querySelectorAll){return b.querySelectorAll(a.join(","))}return[].concat.apply([],a.map(function(c){var d=b.getElementsByTagName(c);return Array.isArray(d)?d:Array.from(d)}))},_fixRelativeUris:function(d){var c=this._uri.scheme;var a=this._uri.prePath;var e=this._uri.pathBase;function g(h){if(/^[a-zA-Z][a-zA-Z0-9\+\-\.]*:/.test(h)){return h}if(h.substr(0,2)=="//"){return c+"://"+h.substr(2)}if(h[0]=="/"){return a+h}if(h.indexOf("./")===0){return e+h.slice(2)}if(h[0]=="#"){return h}return e+h}var b=d.getElementsByTagName("a");this._forEachNode(b,function(i){var h=i.getAttribute("href");if(h){if(h.indexOf("javascript:")===0){var j=this._doc.createTextNode(i.textContent);i.parentNode.replaceChild(j,i)}else{i.setAttribute("href",g(h))}}});var f=d.getElementsByTagName("img");this._forEachNode(f,function(h){var i=h.getAttribute("src");if(i){h.setAttribute("src",g(i))}})},_getArticleTitle:function(){var j=this._doc;var c="";var h="";try{c=h=j.title;if(typeof c!=="string"){c=h=this._getInnerText(j.getElementsByTagName("title")[0])}}catch(i){}var g=false;function d(e){return e.split(/\s+/).length}if((/ [\|\-\\\/>»] /).test(c)){g=/ [\\\/>»] /.test(c);c=h.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1");if(d(c)<3){c=h.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1")}}else{if(c.indexOf(": ")!==-1){var k=this._concatNodeLists(j.getElementsByTagName("h1"),j.getElementsByTagName("h2"));var f=this._someNode(k,function(e){return e.textContent===c});if(!f){c=h.substring(h.lastIndexOf(":")+1);if(d(c)<3){c=h.substring(h.indexOf(":")+1)}}}else{if(c.length>150||c.length<15){var a=j.getElementsByTagName("h1");if(a.length===1){c=this._getInnerText(a[0])}}}}c=c.trim();var b=d(c);if(b<=4&&(!g||b!=d(h.replace(/[\|\-\\\/>»]+/g,""))-1)){c=h}return c},_prepDocument:function(){var a=this._doc;this._removeNodes(a.getElementsByTagName("style"));if(a.body){this._replaceBrs(a.body)}this._replaceNodeTags(a.getElementsByTagName("font"),"SPAN")},_nextElement:function(b){var a=b;while(a&&(a.nodeType!=Node.ELEMENT_NODE)&&this.REGEXPS.whitespace.test(a.textContent)){a=a.nextSibling}return a},_replaceBrs:function(a){this._forEachNode(this._getAllNodesWithTag(a,["br"]),function(d){var f=d.nextSibling;var g=false;while((f=this._nextElement(f))&&(f.tagName=="BR")){g=true;var c=f.nextSibling;f.parentNode.removeChild(f);f=c}if(g){var h=this._doc.createElement("p");d.parentNode.replaceChild(h,d);f=h.nextSibling;while(f){if(f.tagName=="BR"){var b=this._nextElement(f);if(b&&b.tagName=="BR"){break}}var e=f.nextSibling;h.appendChild(f);f=e}}})},_setNodeTag:function(d,a){this.log("_setNodeTag",d,a);if(d.__JSDOMParser__){d.localName=a.toLowerCase();d.tagName=a.toUpperCase();return d}var c=d.ownerDocument.createElement(a);while(d.firstChild){c.appendChild(d.firstChild)}d.parentNode.replaceChild(c,d);if(d.readability){c.readability=d.readability}for(var b=0;b<d.attributes.length;b++){c.setAttribute(d.attributes[b].name,d.attributes[b].value)}return c},_prepArticle:function(a){this._cleanStyles(a);this._markDataTables(a);this._cleanConditionally(a,"form");this._cleanConditionally(a,"fieldset");this._clean(a,"object");this._clean(a,"embed");this._clean(a,"h1");this._clean(a,"footer");this._forEachNode(a.children,function(d){this._cleanMatchedNodes(d,/share/)});var b=a.getElementsByTagName("h2");if(b.length===1){var c=(b[0].textContent.length-this._articleTitle.length)/this._articleTitle.length;if(Math.abs(c)<0.5&&(c>0?b[0].textContent.includes(this._articleTitle):this._articleTitle.includes(b[0].textContent))){this._clean(a,"h2")}}this._clean(a,"iframe");this._clean(a,"input");this._clean(a,"textarea");this._clean(a,"select");this._clean(a,"button");this._cleanHeaders(a);this._cleanConditionally(a,"table");this._cleanConditionally(a,"ul");this._cleanConditionally(a,"div");this._removeNodes(a.getElementsByTagName("p"),function(i){var g=i.getElementsByTagName("img").length;var h=i.getElementsByTagName("embed").length;var d=i.getElementsByTagName("object").length;var f=i.getElementsByTagName("iframe").length;var e=g+h+d+f;return e===0&&!this._getInnerText(i,false)});this._forEachNode(this._getAllNodesWithTag(a,["br"]),function(d){var e=this._nextElement(d.nextSibling);if(e&&e.tagName=="P"){d.parentNode.removeChild(d)}})},_initializeNode:function(a){a.readability={contentScore:0};switch(a.tagName){case"DIV":a.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":a.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":a.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":a.readability.contentScore-=5;break}a.readability.contentScore+=this._getClassWeight(a)},_removeAndGetNext:function(b){var a=this._getNextNode(b,true);b.parentNode.removeChild(b);return a},_getNextNode:function(b,a){if(!a&&b.firstElementChild){return b.firstElementChild}if(b.nextElementSibling){return b.nextElementSibling}do{b=b.parentNode}while(b&&!b.nextElementSibling);return b&&b.nextElementSibling},_getNextNodeNoElementProperties:function(d,a){function b(e){do{e=e.nextSibling}while(e&&e.nodeType!==e.ELEMENT_NODE);return e}if(!a&&d.children[0]){return d.children[0]}var c=b(d);if(c){return c}do{d=d.parentNode;if(d){c=b(d)}}while(d&&!c);return d&&c},_checkByline:function(c,b){if(this._articleByline){return false}if(c.getAttribute!==undefined){var a=c.getAttribute("rel")}if((a==="author"||this.REGEXPS.byline.test(b))&&this._isValidByline(c.textContent)){this._articleByline=c.textContent.trim();return true}return false},_getNodeAncestors:function(c,d){d=d||0;var a=0,b=[];while(c.parentNode){b.push(c.parentNode);if(d&&++a===d){break}c=c.parentNode}return b},_grabArticle:function(g){this.log("**** grabArticle ****");var h=this._doc;var v=(g!==null?true:false);g=g?g:this._doc.body;if(!g){this.log("No body found in document. Abort.");return null}var z=g.innerHTML;while(true){var f=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS);var H=[];var C=this._doc.documentElement;while(C){var R=C.className+" "+C.id;if(this._checkByline(C,R)){C=this._removeAndGetNext(C);continue}if(f){if(this.REGEXPS.unlikelyCandidates.test(R)&&!this.REGEXPS.okMaybeItsACandidate.test(R)&&C.tagName!=="BODY"&&C.tagName!=="A"){this.log("Removing unlikely candidate - "+R);C=this._removeAndGetNext(C);continue}}if((C.tagName==="DIV"||C.tagName==="SECTION"||C.tagName==="HEADER"||C.tagName==="H1"||C.tagName==="H2"||C.tagName==="H3"||C.tagName==="H4"||C.tagName==="H5"||C.tagName==="H6")&&this._isElementWithoutContent(C)){C=this._removeAndGetNext(C);continue}if(this.DEFAULT_TAGS_TO_SCORE.indexOf(C.tagName)!==-1){H.push(C)}if(C.tagName==="DIV"){if(this._hasSinglePInsideElement(C)){var n=C.children[0];C.parentNode.replaceChild(n,C);C=n}else{if(!this._hasChildBlockElement(C)){C=this._setNodeTag(C,"P");H.push(C)}else{this._forEachNode(C.childNodes,function(c){if(c.nodeType===Node.TEXT_NODE&&c.textContent.trim().length>0){var i=h.createElement("p");i.textContent=c.textContent;i.style.display="inline";i.className="readability-styled";C.replaceChild(i,c)}})}}}C=this._getNextNode(C)}var K=[];this._forEachNode(H,function(c){if(!c.parentNode||typeof(c.parentNode.tagName)==="undefined"){return}var t=this._getInnerText(c);if(t.length<25){return}var s=this._getNodeAncestors(c,3);if(s.length===0){return}var i=0;i+=1;i+=t.split(",").length;i+=Math.min(Math.floor(t.length/100),3);this._forEachNode(s,function(W,X){if(!W.tagName){return}if(typeof(W.readability)==="undefined"){this._initializeNode(W);K.push(W)}if(X===0){var V=1}else{if(X===1){V=2}else{V=X*3}}W.readability.contentScore+=i/V})});var k=[];for(var U=0,A=K.length;U<A;U+=1){var L=K[U];var r=L.readability.contentScore*(1-this._getLinkDensity(L));L.readability.contentScore=r;this.log("Candidate:",L,"with score "+r);for(var I=0;I<this._nbTopCandidates;I++){var j=k[I];if(!j||r>j.readability.contentScore){k.splice(I,0,L);if(k.length>this._nbTopCandidates){k.pop()}break}}}var w=k[0]||null;var p=false;var a;if(w===null||w.tagName==="BODY"){w=h.createElement("DIV");p=true;var T=g.childNodes;while(T.length){this.log("Moving child out:",T[0]);w.appendChild(T[0])}g.appendChild(w);this._initializeNode(w)}else{if(w){var E=[];for(var P=1;P<k.length;P++){if(k[P].readability.contentScore/w.readability.contentScore>=0.75){E.push(this._getNodeAncestors(k[P]))}}var S=3;if(E.length>=S){a=w.parentNode;while(a.tagName!=="BODY"){var d=0;for(var b=0;b<E.length&&d<S;b++){d+=Number(E[b].includes(a))}if(d>=S){w=a;break}a=a.parentNode}}if(!w.readability){this._initializeNode(w)}a=w.parentNode;var B=w.readability.contentScore;var m=B/3;while(a.tagName!=="BODY"){if(!a.readability){a=a.parentNode;continue}var x=a.readability.contentScore;if(x<m){break}if(x>B){w=a;break}B=a.readability.contentScore;a=a.parentNode}a=w.parentNode;while(a.tagName!="BODY"&&a.children.length==1){w=a;a=w.parentNode}if(!w.readability){this._initializeNode(w)}}}var D=h.createElement("DIV");if(v){D.id="readability-content"}var O=Math.max(10,w.readability.contentScore*0.2);a=w.parentNode;var N=a.children;for(var J=0,q=N.length;J<q;J++){var M=N[J];var G=false;this.log("Looking at sibling node:",M,M.readability?("with score "+M.readability.contentScore):"");this.log("Sibling has score",M.readability?M.readability.contentScore:"Unknown");if(M===w){G=true}else{var y=0;if(M.className===w.className&&w.className!==""){y+=w.readability.contentScore*0.2}if(M.readability&&((M.readability.contentScore+y)>=O)){G=true}else{if(M.nodeName==="P"){var o=this._getLinkDensity(M);var F=this._getInnerText(M);var e=F.length;if(e>80&&o<0.25){G=true}else{if(e<80&&e>0&&o===0&&F.search(/\.( |$)/)!==-1){G=true}}}}}if(G){this.log("Appending node:",M);if(this.ALTER_TO_DIV_EXCEPTIONS.indexOf(M.nodeName)===-1){this.log("Altering sibling:",M,"to div.");M=this._setNodeTag(M,"DIV")}D.appendChild(M);J-=1;q-=1}}if(this._debug){this.log("Article content pre-prep: "+D.innerHTML)}this._prepArticle(D);if(this._debug){this.log("Article content post-prep: "+D.innerHTML)}if(this._curPageNum===1){if(p){w.id="readability-page-1";w.className="page"}else{var Q=h.createElement("DIV");Q.id="readability-page-1";Q.className="page";var u=D.childNodes;while(u.length){Q.appendChild(u[0])}D.appendChild(Q)}}if(this._debug){this.log("Article content after paging: "+D.innerHTML)}if(this._getInnerText(D,true).length<500){g.innerHTML=z;if(this._flagIsActive(this.FLAG_STRIP_UNLIKELYS)){this._removeFlag(this.FLAG_STRIP_UNLIKELYS)}else{if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES)){this._removeFlag(this.FLAG_WEIGHT_CLASSES)}else{if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)){this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY)}else{return null}}}}else{var l=[a,w].concat(this._getNodeAncestors(a));this._someNode(l,function(c){if(!c.tagName){return false}var i=c.getAttribute("dir");if(i){this._articleDir=i;return true}return false});return D}}},_isValidByline:function(a){if(typeof a=="string"||a instanceof String){a=a.trim();return(a.length>0)&&(a.length<100)}return false},_getArticleMetadata:function(){var b={};var a={};var e=this._doc.getElementsByTagName("meta");var d=/^\s*((twitter)\s*:\s*)?(description|title)\s*$/gi;var c=/^\s*og\s*:\s*(description|title)\s*$/gi;this._forEachNode(e,function(i){var f=i.getAttribute("name");var g=i.getAttribute("property");if([f,g].indexOf("author")!==-1){b.byline=i.getAttribute("content");return}var h=null;if(d.test(f)){h=f}else{if(c.test(g)){h=g}}if(h){var j=i.getAttribute("content");if(j){h=h.toLowerCase().replace(/\s/g,"");a[h]=j.trim()}}});if("description" in a){b.excerpt=a.description}else{if("og:description" in a){b.excerpt=a["og:description"]}else{if("twitter:description" in a){b.excerpt=a["twitter:description"]}}}b.title=this._getArticleTitle();if(!b.title){if("og:title" in a){b.title=a["og:title"]}else{if("twitter:title" in a){b.title=a["twitter:title"]}}}return b},_removeScripts:function(a){this._removeNodes(a.getElementsByTagName("script"),function(b){b.nodeValue="";b.removeAttribute("src");return true});this._removeNodes(a.getElementsByTagName("noscript"))},_hasSinglePInsideElement:function(a){if(a.children.length!=1||a.children[0].tagName!=="P"){return false}return !this._someNode(a.childNodes,function(b){return b.nodeType===Node.TEXT_NODE&&this.REGEXPS.hasContent.test(b.textContent)})},_isElementWithoutContent:function(a){return a.nodeType===Node.ELEMENT_NODE&&a.textContent.trim().length==0&&(a.children.length==0||a.children.length==a.getElementsByTagName("br").length+a.getElementsByTagName("hr").length)},_hasChildBlockElement:function(a){return this._someNode(a.childNodes,function(b){return this.DIV_TO_P_ELEMS.indexOf(b.tagName)!==-1||this._hasChildBlockElement(b)})},_getInnerText:function(c,a){a=(typeof a==="undefined")?true:a;var b=c.textContent.trim();if(a){return b.replace(this.REGEXPS.normalize," ")}return b},_getCharCount:function(b,a){a=a||",";return this._getInnerText(b).split(a).length-1},_cleanStyles:function(a){a=a||this._doc;if(!a){return}var b=a.firstChild;if(typeof a.removeAttribute==="function"&&a.className!=="readability-styled"){a.removeAttribute("style")}while(b!==null){if(b.nodeType===b.ELEMENT_NODE){if(b.className!=="readability-styled"){b.removeAttribute("style")}this._cleanStyles(b)}b=b.nextSibling}},_getLinkDensity:function(b){var a=this._getInnerText(b).length;if(a===0){return 0}var c=0;this._forEachNode(b.getElementsByTagName("a"),function(d){c+=this._getInnerText(d).length});return c/a},_findBaseUrl:function(){var d=this._uri;var c=d.path.split("?")[0];var b=c.split("/").reverse();var a=[];var h="";for(var f=0,e=b.length;f<e;f+=1){var g=b[f];if(g.indexOf(".")!==-1){h=g.split(".")[1];if(!h.match(/[^a-zA-Z]/)){g=g.split(".")[0]}}if(g.match(/((_|-)?p[a-z]*|(_|-))[0-9]{1,2}$/i)&&((f===1)||(f===0))){g=g.replace(/((_|-)?p[a-z]*|(_|-))[0-9]{1,2}$/i,"")}var j=false;if(f<2&&g.match(/^\d{1,2}$/)){j=true}if(f===0&&g.toLowerCase()==="index"){j=true}if(f<2&&g.length<3&&!b[0].match(/[a-z]/i)){j=true}if(!j){a.push(g)}}return d.scheme+"://"+d.host+a.reverse().join("/")},_findNextPageLink:function(s){var f=this._uri;var a={};var b=s.getElementsByTagName("a");var n=this._findBaseUrl();for(var r=0,m=b.length;r<m;r+=1){var h=b[r];var c=b[r].href.replace(/#.*$/,"").replace(/\/$/,"");if(c===""||c===n||c===f.spec||c in this._parsedPages){continue}if(f.host!==c.split(/\/+/g)[1]){continue}var u=this._getInnerText(h);if(u.match(this.REGEXPS.extraneous)||u.length>25){continue}var j=c.replace(n,"");if(!j.match(/\d/)){continue}if(!(c in a)){a[c]={score:0,linkText:u,href:c}}else{a[c].linkText+=" | "+u}var v=a[c];if(c.indexOf(n)!==0){v.score-=25}var k=u+" "+h.className+" "+h.id;if(k.match(this.REGEXPS.nextLink)){v.score+=50}if(k.match(/pag(e|ing|inat)/i)){v.score+=25}if(k.match(/(first|last)/i)){if(!v.linkText.match(this.REGEXPS.nextLink)){v.score-=65}}if(k.match(this.REGEXPS.negative)||k.match(this.REGEXPS.extraneous)){v.score-=50}if(k.match(this.REGEXPS.prevLink)){v.score-=200}var l=h.parentNode;var p=false;var t=false;while(l){var o=l.className+" "+l.id;if(!p&&o&&o.match(/pag(e|ing|inat)/i)){p=true;v.score+=25}if(!t&&o&&o.match(this.REGEXPS.negative)){if(!o.match(this.REGEXPS.positive)){v.score-=25;t=true}}l=l.parentNode}if(c.match(/p(a|g|ag)?(e|ing|ination)?(=|\/)[0-9]{1,2}/i)||c.match(/(page|paging)/i)){v.score+=25}if(c.match(this.REGEXPS.extraneous)){v.score-=15}var g=parseInt(u,10);if(g){if(g===1){v.score-=10}else{v.score+=Math.max(0,10-g)}}}var q=null;for(var e in a){if(a.hasOwnProperty(e)){if(a[e].score>=50&&(!q||q.score<a[e].score)){q=a[e]}}}var d=null;if(q){d=q.href.replace(/\/$/,"");this.log("NEXT PAGE IS "+d);this._parsedPages[d]=true}return d},_successfulRequest:function(a){return(a.status>=200&&a.status<300)||a.status===304||(a.status===0&&a.responseText)},_ajax:function(b,a){var d=new XMLHttpRequest();function c(e){if(d.readyState===4){if(this._successfulRequest(d)){if(a.success){a.success(d)}}else{if(a.error){a.error(d)}}}}if(typeof a==="undefined"){a={}}d.onreadystatechange=c;d.open("get",b,true);d.setRequestHeader("Accept","text/html");try{d.send(a.postBody)}catch(f){if(a.error){a.error()}}return d},_appendNextPage:function(d){var c=this._doc;this._curPageNum+=1;var a=c.createElement("DIV");a.id="readability-page-"+this._curPageNum;a.className="page";a.innerHTML='<p class="page-separator" title="Page '+this._curPageNum+'">&sect;</p>';c.getElementById("readability-content").appendChild(a);if(this._curPageNum>this._maxPages){var b="<div style='text-align: center'><a href='"+d+"'>View Next Page</a></div>";a.innerHTML=a.innerHTML+b;return}(function(f,e){this._ajax(f,{success:function(g){var p=g.getResponseHeader("ETag");if(p){if(p in this._pageETags){this.log("Exact duplicate page found via ETag. Aborting.");a.style.display="none";return}this._pageETags[p]=1}var n=c.createElement("DIV");var j=g.responseText.replace(/\n/g,"\uffff").replace(/<script.*?>.*?<\/script>/gi,"");j=j.replace(/\n/g,"\uffff").replace(/<script.*?>.*?<\/script>/gi,"");j=j.replace(/\uffff/g,"\n").replace(/<(\/?)noscript/gi,"<$1div");j=j.replace(this.REGEXPS.replaceFonts,"<$1span>");n.innerHTML=j;this._replaceBrs(n);this._flags=1|2|4;var o=this._findNextPageLink(n);var l=this._grabArticle(n);if(!l){this.log("No content found in page to append. Aborting.");return}var m=l.getElementsByTagName("P").length?l.getElementsByTagName("P")[0]:null;if(m&&m.innerHTML.length>100){for(var k=1;k<=this._curPageNum;k+=1){var h=c.getElementById("readability-page-"+k);if(h&&h.innerHTML.indexOf(m.innerHTML)!==-1){this.log("Duplicate of page "+k+" - skipping.");a.style.display="none";this._parsedPages[f]=true;return}}}this._removeScripts(l);e.innerHTML=e.innerHTML+l.innerHTML;setTimeout((function(){this._postProcessContent(e)}).bind(this),500);if(o){this._appendNextPage(o)}}})}).bind(this)(d,a)},_getClassWeight:function(b){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES)){return 0}var a=0;if(typeof(b.className)==="string"&&b.className!==""){if(this.REGEXPS.negative.test(b.className)){a-=25}if(this.REGEXPS.positive.test(b.className)){a+=25}}if(typeof(b.id)==="string"&&b.id!==""){if(this.REGEXPS.negative.test(b.id)){a-=25}if(this.REGEXPS.positive.test(b.id)){a+=25}}return a},_clean:function(c,a){var b=["object","embed","iframe"].indexOf(a)!==-1;this._removeNodes(c.getElementsByTagName(a),function(d){if(b){var e=[].map.call(d.attributes,function(f){return f.value}).join("|");if(this.REGEXPS.videos.test(e)){return false}if(this.REGEXPS.videos.test(d.innerHTML)){return false}}return true})},_hasAncestorTag:function(b,a,e,c){e=e||3;a=a.toUpperCase();var d=0;while(b.parentNode){if(e>0&&d>e){return false}if(b.parentNode.tagName===a&&(!c||c(b.parentNode))){return true}b=b.parentNode;d++}return false},_getRowAndColumnCount:function(h){var l=0;var c=0;var g=h.getElementsByTagName("tr");for(var f=0;f<g.length;f++){var d=g[f].getAttribute("rowspan")||0;if(d){d=parseInt(d,10)}l+=(d||1);var a=0;var k=g[f].getElementsByTagName("td");for(var e=0;e<k.length;e++){var b=k[e].getAttribute("colspan")||0;if(b){b=parseInt(b,10)}a+=(b||1)}c=Math.max(c,a)}return{rows:l,columns:c}},_markDataTables:function(h){var j=h.getElementsByTagName("table");for(var d=0;d<j.length;d++){var k=j[d];var c=k.getAttribute("role");if(c=="presentation"){k._readabilityDataTable=false;continue}var b=k.getAttribute("datatable");if(b=="0"){k._readabilityDataTable=false;continue}var f=k.getAttribute("summary");if(f){k._readabilityDataTable=true;continue}var l=k.getElementsByTagName("caption")[0];if(l&&l.childNodes.length>0){k._readabilityDataTable=true;continue}var g=["col","colgroup","tfoot","thead","th"];var a=function(i){return !!k.getElementsByTagName(i)[0]};if(g.some(a)){this.log("Data table because found data-y descendant");k._readabilityDataTable=true;continue}if(k.getElementsByTagName("table")[0]){k._readabilityDataTable=false;continue}var e=this._getRowAndColumnCount(k);if(e.rows>=10||e.columns>4){k._readabilityDataTable=true;continue}k._readabilityDataTable=e.rows*e.columns>10}},_cleanConditionally:function(c,a){if(!this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)){return}var b=a==="ul"||a==="ol";this._removeNodes(c.getElementsByTagName(a),function(i){var h=function(p){return p._readabilityDataTable};if(this._hasAncestorTag(i,"table",-1,h)){return false}var l=this._getClassWeight(i);var g=0;this.log("Cleaning Conditionally",i);if(l+g<0){return true}if(this._getCharCount(i,",")<10){var f=i.getElementsByTagName("p").length;var k=i.getElementsByTagName("img").length;var s=i.getElementsByTagName("li").length-100;var q=i.getElementsByTagName("input").length;var r=0;var e=i.getElementsByTagName("embed");for(var j=0,o=e.length;j<o;j+=1){if(!this.REGEXPS.videos.test(e[j].src)){r+=1}}var n=this._getLinkDensity(i);var d=this._getInnerText(i).length;var m=(k>1&&f/k<0.5&&!this._hasAncestorTag(i,"figure"))||(!b&&s>f)||(q>Math.floor(f/3))||(!b&&d<25&&(k===0||k>2)&&!this._hasAncestorTag(i,"figure"))||(!b&&l<25&&n>0.2)||(l>=25&&n>0.5)||((r===1&&d<75)||r>1);return m}return false})},_cleanMatchedNodes:function(d,c){var b=this._getNextNode(d,true);var a=this._getNextNode(d);while(a&&a!=b){if(c.test(a.className+" "+a.id)){a=this._removeAndGetNext(a)}else{a=this._getNextNode(a)}}},_cleanHeaders:function(b){for(var a=1;a<3;a+=1){this._removeNodes(b.getElementsByTagName("h"+a),function(c){return this._getClassWeight(c)<0})}},_flagIsActive:function(a){return(this._flags&a)>0},_addFlag:function(a){this._flags=this._flags|a},_removeFlag:function(a){this._flags=this._flags&~a},parse:function(){if(this._maxElemsToParse>0){var c=this._doc.getElementsByTagName("*").length;if(c>this._maxElemsToParse){throw new Error("Aborting parsing document; "+c+" elements found")}}if(typeof this._doc.documentElement.firstElementChild==="undefined"){this._getNextNode=this._getNextNodeNoElementProperties}this._removeScripts(this._doc);this._prepDocument();var b=this._getArticleMetadata();this._articleTitle=b.title;var a=this._grabArticle();if(!a){return null}this.log("Grabbed: "+a.innerHTML);this._postProcessContent(a);if(!b.excerpt){var e=a.getElementsByTagName("p");if(e.length>0){b.excerpt=e[0].textContent.trim()}}var d=a.textContent;return{uri:this._uri,title:this._articleTitle,byline:b.byline||this._articleByline,dir:this._articleDir,content:a.innerHTML,textContent:d,length:d.length,excerpt:b.excerpt}}};if(typeof module==="object"){module.exports=Readability}function parse(d){const b=50;var a="";try{var c=document.cloneNode(true);var i=document.location;var f={spec:i.href,host:i.host,prePath:i.protocol+"//"+i.host,scheme:i.protocol.substr(0,i.protocol.indexOf(":")),pathBase:i.protocol+"//"+i.host+i.pathname.substr(0,i.pathname.lastIndexOf("/")+1)};var h=new Readability(f,c).parse();if(h.content&&h.length>b){a=buildHtmlContent(h)}else{a=""}}catch(g){a=""}ReaderModeParser.showHtml(a,d);return null}function buildHtmlContent(a){var b='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />';if(a.title){b+="<title>"+a.title+"</title>"}b+='<style id="upbrowser_readermode_style">{upbrowser_readermode_style}</style></head>';b+="<body>";if(a.title){b+='<div id="upbrowser_article_title">'+a.title+"</div>"}b+="<div id='upbrowser_article_content'>"+a.content+"</div>";b+="</body></html>";return b};